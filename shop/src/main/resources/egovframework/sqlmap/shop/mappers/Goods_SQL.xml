<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="shop.service.impl.GoodsMapper">
	
	<insert id="insertGoods" parameterType="GoodsVO">
		<selectKey keyProperty="goods_idx" resultType="Integer" order="BEFORE">
			<![CDATA[SELECT goods_seq.nextval AS goods_idx FROM dual]]>
		</selectKey>
		<![CDATA[
		INSERT INTO GOODS(
			goods_idx
			, goods_name
			, goods_desc
			, goods_price
			, goods_img
			, goods_thumb
			, category_idx
			, goods_color
			, goods_size
			, goods_regdate
			, goods_register
		) VALUES (
			goods_seq.nextval
			, #{goods_name}
			, #{goods_desc}
			, #{goods_price}
			, #{goods_img}
			, #{goods_thumb}
			, #{category_idx}
			, #{goods_color}
			, #{goods_size}
			, to_char(sysdate, 'YYYY-MM-DD HH24:MI:SS')
			, #{goods_register}
		)
		]]>
	</insert>
	
	<!-- 카테고리별 상품조회 조건문 -->
	<sql id="goodsWhere"> 	
		<if test="b_idx != 0">
			AND CATEGORY_B_IDX = #{b_idx}
		</if>
		<if test="m_idx != 0">
			AND category_m_idx = #{m_idx}
		</if> 
	</sql>
	
	<select id="selectGoodsList" parameterType="ShopDefaultVO" resultType="GoodsVO">
		SELECT * FROM(
			SELECT 
				goods_name, goods_desc, goods_price, goods_thumb, goods_idx
				, goods_regdate, category_b_idx, category_m_idx, rownum as rnum 
			FROM(
				SELECT
					goods_name, SUBSTR(TRIM(goods_desc), 1, 10) AS goods_desc, goods_price
					, goods_thumb, goods_idx, goods_regdate, category_b_idx, category_m_idx
				FROM
					GOODS
					WHERE 1=1
				<include refid="goodsWhere" />
				<!-- ORDER BY goods_regdate DESC -->
				ORDER BY ${orderValue} ${ascDesc}
			 	)
		) WHERE rnum BETWEEN #{firstIndex}+1 AND #{firstIndex}+#{recordCountPerPage}
		<!-- ) WHERE rnum BETWEEN 1 AND 9 -->
	</select>
	
	<select id="selectGoodsListCnt" parameterType="ShopDefaultVO" resultType="int">
		SELECT COUNT(*) totcnt
		FROM GOODS
		WHERE 1=1
		<include refid="goodsWhere" />
	</select>
	
	<select id="selectOneGoods" parameterType="int" resultType="GoodsVO">
		SELECT * 
		FROM GOODS
		WHERE goods_idx=#{goods_idx}
	</select>
</mapper>